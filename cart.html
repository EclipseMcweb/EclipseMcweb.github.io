<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>MediaMC Carrello</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin:0;
  font-family:'Segoe UI',Arial;
  background:linear-gradient(135deg,#0ea5e9,#020617);
  color:#fff;
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100vh;
}

#topBar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  width:90%;
  max-width:700px;
  padding:10px 20px;
  background:rgba(2,6,23,.9);
  margin-top:20px;
  border-radius:10px;
  border:2px solid #38bdf8;
}

#nickDisplay{font-weight:bold;}
#logoutBtn{background:#ef4444;color:#fff;border:none;padding:4px 8px;border-radius:6px;cursor:pointer;}

h1{text-align:center;margin:20px 0;}

#cartContainer{
  width:90%;
  max-width:700px;
  background:rgba(2,6,23,.85);
  border:2px solid #38bdf8;
  border-radius:12px;
  padding:20px;
  margin-bottom:30px;
}

.productItem{
  display:flex;
  justify-content:space-between;
  background:rgba(0,10,30,0.7);
  padding:10px;
  border-radius:6px;
  margin:5px 0;
}

button{
  background:#38bdf8;
  border:none;
  color:#fff;
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer;
  margin-left:5px;
}
button.red{background:#ef4444;}
button.back{background:#facc15;color:#000;}
</style>
</head>
<body>

<div id="topBar">
  <div id="nickDisplay">Player: </div>
  <button id="logoutBtn" onclick="logout()">Logout</button>
</div>

<h1>üõí Carrello MediaMC</h1>

<div id="cartContainer">
  <div id="cartList"></div>
  <h3>Totale: ‚Ç¨<span id="total">0</span></h3>

  <button onclick="checkout()">Procedi Ordine</button>
  <button class="red" onclick="clearCart()">Svuota Carrello</button>
  <button class="back" onclick="backToStore()">‚¨ÖÔ∏è Torna allo Store</button>
</div>

<script>
let nick = sessionStorage.getItem('nick');
if(!nick){
  alert('Inserisci il nick prima!'); 
  location.href='store.html';
}
document.getElementById('nickDisplay').textContent = `Player: ${nick}`;

function logout(){
  sessionStorage.removeItem('nick');
  location.href='store.html';
}

function loadCart(){
  const cart = JSON.parse(localStorage.getItem('cart_'+nick))||[];
  const listDiv = document.getElementById('cartList');
  let total = 0;
  listDiv.innerHTML='';
  cart.forEach((p,idx)=>{
    total += p.price;
    const div = document.createElement('div');
    div.className = 'productItem';
    div.innerHTML = `<span>${p.name} - ‚Ç¨${p.price}</span><div><button onclick="removeItem(${idx})">X</button></div>`;
    listDiv.appendChild(div);
  });
  document.getElementById('total').textContent = total;
}

function removeItem(idx){
  let cart = JSON.parse(localStorage.getItem('cart_'+nick))||[];
  cart.splice(idx,1);
  localStorage.setItem('cart_'+nick,JSON.stringify(cart));
  loadCart();
}

function clearCart(){
  localStorage.removeItem('cart_'+nick);
  loadCart();
}

function checkout(){
  let cart = JSON.parse(localStorage.getItem('cart_'+nick))||[];
  if(cart.length===0){ alert('Carrello vuoto!'); return; }
  const total = cart.reduce((s,p)=>s+p.price,0);
  const id = 'MM-'+Math.floor(Math.random()*100000);
  localStorage.setItem('checkoutData',JSON.stringify({id,nick,cart,total}));
  let list = JSON.parse(localStorage.getItem('checkoutDataList'))||[];
  list.push({id,nick,cart,total});
  localStorage.setItem('checkoutDataList',JSON.stringify(list));
  localStorage.removeItem('cart_'+nick);
  location.href='checkout.html';
}

function backToStore(){
  location.href='store.html';
}

loadCart();
</script>

</body>
</html>
