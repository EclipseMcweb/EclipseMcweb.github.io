<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Carrello</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:'Segoe UI';background:linear-gradient(135deg,#0ea5e9,#020617);color:#fff}
section{max-width:600px;margin:40px auto;background:rgba(2,6,23,.8);border:2px solid #38bdf8;border-radius:14px;padding:20px}
.product{display:flex;justify-content:space-between;margin:6px 0}
button{background:#38bdf8;border:none;color:#fff;padding:6px 10px;border-radius:6px}
</style>
</head>
<body>

<section>
<h2>üõí Carrello</h2>
<div id="list"></div>
<p><b>Totale:</b> ‚Ç¨<span id="tot">0</span></p>

<h3>Giftcard</h3>
<input id="gift" placeholder="Codice gift">
<button onclick="gift()">Applica</button>

<br><br>
<button onclick="go()">Procedi ordine</button>
<button onclick="location.href='store.html'">‚Üê Torna allo store</button>
</section>

<script>
const nick=sessionStorage.getItem('nick');
if(!nick){location.href='store.html'}
let cart=JSON.parse(localStorage.getItem('cart_'+nick))||[];
let giftV=0;

function render(){
 let t=0,l=document.getElementById('list');l.innerHTML='';
 cart.forEach(p=>{t+=p.price;l.innerHTML+=`<div class="product"><span>${p.name}</span><span>‚Ç¨${p.price}</span></div>`});
 t=Math.max(0,t-giftV);
 document.getElementById('tot').textContent=t;
}
render();

function gift(){
 const g=(JSON.parse(localStorage.getItem('giftCards'))||[]).find(x=>x.code===document.getElementById('gift').value);
 if(!g||g.used){alert("Gift non valida");return;}
 g.used=true;giftV=g.value;
 localStorage.setItem('giftCards',JSON.stringify(JSON.parse(localStorage.getItem('giftCards'))));
 render();
}

function go(){
 if(cart.length===0){alert("Carrello vuoto");return;}
 localStorage.setItem('checkout',JSON.stringify({nick,cart,total:document.getElementById('tot').textContent,id:'MM-'+Date.now()}));
 location.href='checkout.html';
}
</script>
</body>
</html>
